# 《MySQL 必知必会》教程分析笔记

## 第11章 索引：怎么提高查询的速度

### Q1：这一章的内容属于哪一类别

数据库/MySQL。

### Q2：这一章的内容是什么

介绍数据库索引的基础知识。

### Q3：这一章的大纲是什么

- 索引是什么？
- 单字段索引
  - 如何创建单字段索引？
  - 单字段索引的作用原理
  - 如何选择索引字段？
- 组合索引
  - 如何创建组合索引？
  - 组合索引的原理
- 索引的成本

### Q4：作者想要解决什么问题

- 索引是什么？
- 如何使用索引？

### Q5：这一章的关键词是什么

### Q6：这一章的关键句是什么

#### 索引是什么

- MySQL 中的索引，就相当于图书馆的检索目录，它是帮助 MySQL 系统快速检索数据的一种存储结构。
  - 我们可以在索引中按照查询条件，检索索引字段的值，然后快速定位数据记录的位置，这样就不需要遍历整个数据表了。
  - 而且，数据表中的字段越多，表中数据记录越多，速度提升越是明显。

#### 单字段索引

- 创建索引

  ```sql
  /* 直接给数据表创建索引 */
  CREATE INDEX index_name ON TABLE tbl_name (key_part, ...)

  /* 在创建表的同时创建索引 */
  CREATE TABLE tbl_name
  (
    col_name data_type,
    ...
    {INDEX | KEY} index_name (key_part, ...)
  )

  /* 修改表时创建索引 */
  ALTER TABLE tbl_name ADD {INDEX | KEY} index_name (key_part, ...)
  ```

- 给表设定主键约束或者唯一性约束的时候，MySQL 会自动创建主键索引或唯一性索引。

- EXPLAIN 关键字能够查看 SQL 语句的执行细节，包括表的加载顺序，表是如何连接的，以及索引使用情况等。
  - `type=range`：表示使用索引查询特定范围的数据记录。
  - `rows=5411`：表示需要读取的记录数。
  - `possible_keys=index_trans`：表示可以选择的索引是 index_trans。
  - `key=index_trans`：表示实际选择的索引是 index_trans。
  - `extra=Using index condition;Using where;Using MRR`：这里面的信息对 SQL 语句的执行细节做了进一步的解释，包含了 3 层含义：
    - 第一个是执行时使用了索引，
    - 第二个是执行时通过 WHERE 条件进行了筛选，
    - 第三个是使用了顺序磁盘读取的策略。

- 如何选择索引字段
  - 选择索引字段的时候，要选择那些经常被用做筛选条件的字段。这样才能发挥索引的作用，提升检索的效率。

#### 组合索引

- 如果有多个索引，而这些索引的字段同时作为筛选字段出现在查询中的时候，MySQL 会选择使用最优的索引来执行查询操作。

- 组合索引的原理
  - 组合索引的多个字段是有序的，遵循左对齐的原则。
  - 筛选的条件也要遵循从左向右的原则，如果中断，那么，断点后面的条件就没有办法利用索引了。
  - 类似的，如果筛选的是一个范围，如果没有办法无法精确定位，也相当于中断。

#### 索引的成本

- 创建索引的成本
  - 存储空间的开销，是指索引需要单独占用存储空间。
  - 数据操作上的开销，是指一旦数据表有变动，无论是插入一条新数据，还是删除一条旧的数据，甚至是修改数据，如果涉及索引字段，都需要对索引本身进行修改，以确保索引能够指向正确的记录。

- 因此，索引也不是越多越好，创建索引有存储开销和操作开销，需要综合考虑。

### Q9：我有哪些疑问

#### Q9.1: 对组合索引的工作原理不是很理解
